{% extends 'quizzes/base.html' %}
{% block content %}

{%if quiz_request %}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>
	var answerArray = []
	var scoring = []
	var scoringArray = []
	var numResults = 0
	function computeResults(answer,question,operation){
		if(operation=="add"){
			for (var i = 0 ;i<numResults;i++){
				//this sets the value of the displayed result to be the value of the current result
				//plus the value in the scoring array corresponding to the results,question and answer
				$("#r"+(i+1)).text(parseInt($("#r"+(i+1)).text()) + parseInt(scoringArray[i][question-1][answer-1]))
				//	$("#r1").text(parseInt($("#r1").text()) - parseInt(scoringArray[0][0][answerArray[0]-1]))
				//}
			}
		}
			else{
				for (var i =0; i<numResults;i++){
					//if (answerArray[answer] != 0){
					$("#r"+(i+1)).text(parseInt($("#r"+(i+1)).text()) - parseInt(scoringArray[i][question-1][answer-1]))
			}
				//}
			}
	}

	function updateResults(question){
		var questionNumber = parseInt(question.substring(9))
		var answer = parseInt($("input:radio[name='"+question+"']:checked").val())
		//is this the first time the user has answered the question?
		//assumes all result values are positive
		if(answerArray[questionNumber-1]!=0){
			computeResults(answerArray[questionNumber-1],questionNumber,"subtract")
			answerArray[questionNumber-1] = parseInt(answer)
		}
		answerArray[questionNumber-1] = parseInt(answer)
		computeResults(answer,questionNumber,"add")
	}
	</script>
<h1>	{{ quiz_request.Quiz_Title }}  </h1>
<h2>{{ quiz_request.Quiz_Description }} </h2>

<form action="results/" method=post>
	{% csrf_token %}
{% for question in quiz_questions %}
<h3>{{question.question_text}}</h3>
<script type="text/javascript">
answerArray.push(0)
</script>
{% for a in question.answer_set.all %}
<input type="radio" name= "question-{{question.questionNumber}}" class="question-{{question.questionNumber}}" value={{a.answerNumber}}>{{a.answertext}}<br>
{% endfor %}
{% endfor %}
{% for result in quiz_results %}
<h4>{{result.Quiz_Result}}</h4>
<div id ="r{{result.resultNumber}}">0
</div>
<script type="text/javascript">
	var scoring = "{{result.Quiz_Scoring}}"
	scoring = scoring.replace(/u&#39;/g, "")
	scoring = scoring.replace(/&#39;/g, "")
	//scoringArray.push(scoring)
	scoring = scoring.replace("[[","")
	scoring = scoring.replace("]]","")
	scoring = scoring.split("], [")
	for (var i = 0; i< scoring.length; i++){
		scoring[i] = scoring[i].split(",")
	}numResults++
	scoringArray.push(scoring)
</script>
{% endfor %}
<input type='submit'>
</form>
{% else %}
    <p>No quiz matches that name.</p>
{% endif %}
{% endblock %}